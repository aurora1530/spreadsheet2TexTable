<script>
  document.getElementById('convertBtn').addEventListener('click', () => {
    const tableOptions = validateTableOptions()
    google.script.run.withSuccessHandler(copyToClipboard).withFailureHandler(failureHandler).tableOptionsHandler(tableOptions)
  })

  function validateTableOptions() {
    const tableLocation = document.getElementById('tableLocation').value
    const caption = document.getElementById('caption').value
    const timezone = document.getElementById('timezone').value
    const format = document.getElementById('format').value
    let doesAddingFromEnd = document.getElementById('doesAddingFromEnd').value
    const columnParameters = document.getElementById('columnParameters').value
    let rowsRequiringHline = document.getElementById('rowsRequiringHline').value
    let doesAddHlineToAll = document.getElementById('doesAddHlineToAll').value

    doesAddingFromEnd = doesAddingFromEnd === 'False' ? false : true //if invalid value, set true

    rowsRequiringHline = rowsRequiringHline.split(',')
      .map((num) => parseInt(num)).filter(num => !isNaN(num))

    doesAddHlineToAll = doesAddHlineToAll === 'True' ? true : false //if invalid value, set false

    const tableOptions = {
      tableLocation: tableLocation,
      caption: caption,
      dateFormatOptions: {
        timezone: timezone,
        format: format
      },
      matrixOptions: {
        doesAddingFromEnd: doesAddingFromEnd
      },
      tabularOptions: {
        columnParameters: columnParameters,
        rowsRequiringHline: rowsRequiringHline,
        doesAddHlineToAll: doesAddHlineToAll
      }
    }
    return tableOptions
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text)
      .then(() => {
        alert('copied!')
      })
      .catch((err) => {
        alert(`failed to copy.\nClient error:${err}`)
      })
  }

  function failureHandler(err) {
    alert(`failed to copy.\nServer error:${err}`)
  }

</script>