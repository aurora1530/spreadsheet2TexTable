<script>
  document.getElementById('convertBtn').addEventListener('click', () => {
    const tableOptions = validateTableOptions()
    google.script.run.withSuccessHandler(copyToClipboard).withFailureHandler(failureHandler).tableOptionsHandler(tableOptions)
  })

  function validateTableOptions() {
    const tableLocation = document.getElementById('tableLocation').value
    const caption = document.getElementById('caption').value
    const timezone = document.getElementById('timezone').value
    const format = document.getElementById('format').value
    let isAddingFromEnd = document.getElementById('isAddingFromEnd').value
    const columnParameters = document.getElementById('columnParameters').value
    let rowsRequiringHline = document.getElementById('rowsRequiringHline').value

    isAddingFromEnd = isAddingFromEnd === 'False' ? false : true //if invalid value, set true

    rowsRequiringHline = rowsRequiringHline.split(',')
      .map((num) => parseInt(num)).filter(num => !isNaN(num))

    const tableOptions = {
      tableLocation: tableLocation,
      caption: caption,
      dateFormatOptions: {
        timezone: timezone,
        format: format
      },
      matrixOptions: {
        isAddingFromEnd: isAddingFromEnd
      },
      tabularOptions: {
        columnParameters: columnParameters,
        rowsRequiringHline: rowsRequiringHline
      }
    }
    return tableOptions
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text)
      .then(() => {
        alert('copied!')
      })
      .catch((err) => {
        alert(`failed to copy.\nClient error:${err}`)
      })
  }

  function failureHandler(err) {
    alert(`failed to copy.\nServer error:${err}`)
  }

</script>